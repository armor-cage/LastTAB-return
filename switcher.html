<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>LastTAB-return - siatka kart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root {
    --gap: 8px;
    --tile-min-w: 200px;
    --tile-h: 30px;
    --tile-pad: 5px;
    --grid-mode: grid;
    --columns-gap: 12px;
    --controls-minw: 180px;
    --fav-size: 16px;

    /* --- KOLOR BAZOWY (HEX) --- */
    --marquee-stroke: #0969da; /* G≈Ç√≥wny kolor (niebieski domy≈õlnie) */

    /* Automatyczne odcienie z HEX przy u≈ºyciu color-mix */
    /* T≈Ço: 12% koloru bazowego, reszta przezroczysta */
    --selected-bg: color-mix(in srgb, var(--marquee-stroke) 12%, transparent);

    --selected-glow: color-mix(in srgb, var(--marquee-stroke) 12%, transparent);
    
    --drag-target-bg: #ffe9e9; /* Cel DnD (czerwony) */

    color-scheme: light dark;
  }

  @media (prefers-color-scheme: dark) {
    /* 1. BAZA */
    body { background: #0d1117; color: #c9d1d9; }
    
    /* 2. HEADER / FOOTER / LINIE */
    header { background: #161b22; border-bottom-color: #30363d; }
    footer { border-top-color: #30363d; color: #8b949e; background: #0d1117; }
    .sep { background: #30363d; }

    /* 3. TEKSTY */
    .muted-text, .pin, .meta { color: #8b949e; }
    /* Etykiety w ustawieniach (jasne) */
    .control label { color: #e6edf3; } 
    .control label .lab { color: #8b949e; } /* (opcjonalnie etykieta pola nieco ciemniejsza) */
    /* Tytu≈Çy kart (bia≈Çe) */
    .title { color: #f0f6fc; }

    /* 4. PRZYCISKI / INPUTY / POPUPY */
    .btn, input[type="text"], input[type="number"], input[type="search"], select {
        background: #0d1117; color: #c9d1d9; border-color: #30363d;
    }
    .btn:hover { background: #21262d; }
    
    .settings-toggle { background: #0d1117; color: #c9d1d9; border-color: #30363d; }
    .settings-toggle:hover { background: #1f232a; }

    .section { background: #161b22; border-color: #30363d; }
    .section > legend { color: #8b949e; }

    /* 5. KAFLE */
    .grid.columns .tile, .tile { 
        background-color: #161b22; 
        border-color: #30363d; 
        box-shadow: none; 
    }
    /* Hover - rozja≈õnienie */
    .tile:hover { 
        background-image: linear-gradient(rgba(255,255,255,0.08), rgba(255,255,255,0.08));
        background-color: unset;
    }
    /* Zaznaczenie - ciemne t≈Ço pod spodem */
    .tile.selected { background-color: #161b22; }
    .tile.selected.in-selected-group { background-color: transparent; }

    /* 6. IKONY / FAVICONY */
    /* Ciemne t≈Ço pod ikonkƒÖ (zamiast bia≈Çego) */
    .fav-wrap { background: #21262d; }
    .grid .tile > .fav-wrap > img.fav { filter: brightness(0.9); } /* Lekko przyga≈õ zbyt jasne ikony */

    /* Folder grupy (ikonka literowa) */
    .fav.is-letter { color: #fff; }

    /* 7. GRUPY */
    .group-chip { background: #161b22; border-color: #30363d; color: #f0f6fc; }
    .group-chip:hover { background: #1f232a; }
    .group-chip.selected { background: #161b22; }
    .group-chip .actions .btn-icon { color: #8b949e; }
    .group-chip .actions .btn-icon:hover { color: #c9d1d9; }
    .grp-collapsed-count { color: #8b949e; border-color: #30363d; }

    /* 8. MENU / POPUP (Wa≈ºne: wyra≈∫ne t≈Ço i ramka) */
    .menu, #groupEditDialog, .help-panel-top {
        background: #161b22 !important;
        border-color: #30363d !important;
        color: #e6edf3 !important;
        box-shadow: 0 8px 24px rgba(0,0,0,0.8) !important;
    }
    /* Tekst w menu */
    .menu .mi { color: #e6edf3; }
    .menu .mi:hover { background: #1f232a; }
    .menu .m, .menu .empty { color: #8b949e; }
    /* Ikony w menu (folder/oko) */
    .menu .mi div:first-child { color: #8b949e; } /* Szare ikony zamiast czarnych */

    /* 9. ≈öPM (UZBROJENIE - Czerwony) */
    .tile.mmb-armed { 
        background-color: #161b22; /* baza */
        background-image: linear-gradient(rgba(255, 50, 50, 0.25), rgba(255, 50, 50, 0.25));
    }
    /* Cel DnD */
    .tile.drag-target {
        background-color: #161b22;
        background-image: linear-gradient(rgba(255, 50, 50, 0.25), rgba(255, 50, 50, 0.25));
    }

    /* 10. INNE */
    .help-btn-top { background: #0d1117; border-color: #30363d; color: #c9d1d9; }
    .help-btn-top:hover { background: #1f232a; }
    
    .smart-tip {
      color: #c9d1d9;
      background: #161b22;
      border-color: #30363d;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    
    /* Aktywna karta (ramka) */
    .active { border-color: var(--marquee-stroke); box-shadow: 0 0 0 2px var(--selected-glow); }
  }

  html, body { height: 100%; }
  body {
    font-family: system-ui, sans-serif;
    margin: 0;
    color: #1f2328;
    display: grid;
    grid-template-rows: auto 1fr auto; /* header | main | footer */
    min-height: 100vh;
    overflow: hidden; /* tylko main ma mieƒá scroll */
  }

  header {
    background: #f6f8fa;
    border-bottom: 1px solid #d0d7de;
    padding: 0px 20px 6px 20px;
  }


.color-swatch {
  width: 16px; height: 16px; border-radius: 50%; border: 3px solid transparent; cursor: pointer;
}
.color-swatch.selected { border-color: #000; transform: scale(1.1); }
@media (prefers-color-scheme: dark) { .color-swatch.selected { border-color: #fff; } }

  /* ‚Äû?‚Äù po prawej krawƒôdzi tego samego paska */
.help-btn-top {
    position: absolute;
    right: 2px;
    top: 2px;
    width: 18px;
    height: 18px;
    border-radius: 999px;
    border: 1px solid #d0d7de;
    background: #fff;
    color: #24292f;
    font-weight: 700;
    font-size: 12px;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}
  .help-btn-top:hover { background: #f3f4f6; }
  .help-btn-top:focus { outline: 2px solid #0969da33; outline-offset: 2px; }

  /* Panel pomocy przy prawej krawƒôdzi, pod przyciskiem ‚Äû?‚Äù */
  .help-panel-top {
    position: absolute;
    top: 25px; right: 20px;
    width: min(560px, 92vw);
    max-height: min(70vh, 560px);
    overflow: auto;
    padding: 12px;
    background: #fff;
    color: #24292f;
    border: 1px solid #9aa3ad;
    border-radius: 8px;
    z-index: 10050;
    box-shadow: none;
  }
  .help-panel-top .hp-title { font-size: 14px; font-weight: 600; color: #57606a; margin-bottom: 8px; }
  .help-panel-top .hp-body { font-size: 13px; line-height: 1.4; }
  .help-panel-top .hp-body ul { margin: 8px 0 0 18px; padding: 0; }
  .help-panel-top .hp-body li { margin: 4px 0; }
  
  .controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--controls-minw), 1fr));
    gap: 8px 10px;
    align-items: center;
  }
  .controls.compact { gap: 6px 8px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }

  .control { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; min-width: 0; }
  .control label { display: flex; align-items: center; gap: 6px; font-size: 13px; }
  .control input[type="number"] { width: 56px; }
  .control select { max-width: 100%; min-width: 100px; }
  .control--actions { justify-self: end; }

  /* Rewers dla p√≥l: warto≈õƒá po lewej, etykieta po prawej z separatorem ‚Äû : ‚Äù */
  .control label.rev { flex-direction: row-reverse; }
  .control label.rev .lab { white-space: nowrap; }
  .control label.rev .lab::before { content: " : "; color: #8b949e; }

  .muted-text { color: #666; font-size: 12px; }
  .sep { height: 1px; background: #d0d7de; margin: 8px 0; }

  .btn {
    appearance: none; border: 1px solid #d0d7de; background: #fff; color: #24292f;
    font-size: 13px; cursor: pointer; padding: 4px 8px; border-radius: 6px;
  }
  .btn:hover { background: #f3f4f6; }

  /* Sekcje (fieldset + legend) */
  .sections { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 8px; }
  .section { margin: 0; border: 1px solid #d0d7de; border-radius: 8px; background: #fff; padding: 8px 10px; }
  .section > legend { padding: 0 6px; font-size: 12px; font-weight: 600; color: #57606a; }

  main { padding: 0; overflow: auto; }

  /* Siatka (poziomy/automatyczny) */
  .grid {
    display: var(--grid-mode);
    gap: var(--gap);
    align-items: start;
    grid-auto-rows: minmax(calc(var(--tile-h) + 2*var(--tile-pad)), auto);
    position: relative;
margin: 10px;
    padding: var(--gap);
    box-sizing: border-box;
  }

  /* Pionowy (kolumny) ‚Äî tryb kolumnowy */
  .grid.columns {
    column-gap: var(--columns-gap);
    padding-left: var(--columns-gap);
    padding-right: var(--columns-gap);
  }
  .grid.columns .tile {
    break-inside: avoid-column;
    width: 100%; display: grid;
    grid-template-columns: var(--fav-size) 1fr auto;
    margin-bottom: var(--gap);
  }

  .tile {
    display: grid; grid-template-columns: var(--fav-size) 1fr auto; align-items: center; gap: 8px;
    width: 100%; min-width: 0; min-height: calc(var(--tile-h) + 2*var(--tile-pad));
    padding: var(--tile-pad); box-sizing: border-box;
    border: 1px solid #9aa3ad; border-radius: 8px; 
    background-color: #fff; /* Baza */
    cursor: pointer; user-select: none; box-shadow: 0 1px 0 rgba(31,35,40,.04);
    container-type: inline-size; container-name: tile;
    position: relative; /* Wa≈ºne dla z-index i pseudo-element√≥w */
    z-index: 0;
    overflow: hidden; /* ≈ªeby hover nie wystawa≈Ç */
  }

  /* Pseudo-element do Hovera (szara mgie≈Çka) */
  .tile::after {
    content: ""; position: absolute; inset: 0;
    background: currentColor; /* U≈ºywa koloru tekstu (czarny/bia≈Çy) */
    opacity: 0; /* Domy≈õlnie niewidoczny */
    pointer-events: none;
    transition: opacity 0.1s;
  }
  
  /* Aktywacja Hovera */
  .tile:hover::after {
    opacity: 0.06; /* Poka≈º mgie≈Çkƒô (6%) */
  }

  /* Stan Zaznaczony (.selected) */
  .tile.selected {
    z-index: 2; /* Wyskocz ponad grupƒô */
    background-color: #fff; /* Solidne t≈Ço zakrywajƒÖce grupƒô */
    
    /* Kolor zaznaczenia jako gradient na wierzchu */
    background-image: linear-gradient(var(--selected-bg), var(--selected-bg));
    
    box-shadow:
      0 0 0 2px var(--selected-glow) inset,
      0 0 0 3px var(--selected-glow);
  }

  /* FIX: Je≈õli kafel jest w zaznaczonej grupie -> usu≈Ñ jego t≈Ço */
  .tile.selected.in-selected-group {
      background-color: transparent;
  }

  /* UNIKANIE PODW√ìJNEGO T≈ÅA:
     Je≈õli kafel jest zaznaczony (.selected), ale le≈ºy w zaznaczonej grupie (.in-selected-group - wymagane z JS),
     to usuwamy t≈Ço kafla, bo t≈Ço grupy ju≈º tam jest. Zostaje tylko ramka i hover. */
  .tile.selected.in-selected-group {
      background-color: transparent;
  }
  .tile.drag-target { background: var(--drag-target-bg); }
  .tile.mmb-armed { background: var(--drag-target-bg); }

  .fav-wrap {
    width: var(--fav-size); height: var(--fav-size); border-radius: 3px; overflow: hidden;
    display: flex; align-items: center; justify-content: center; background: #e9ecef;
  }
  .fav {
    display: block; width: 100% !important; height: 100% !important;
    max-width: 100% !important; max-height: 100% !important; object-fit: contain !important;
    image-rendering: -webkit-optimize-contrast;
  }
  .fav.is-letter {
    display: inline-flex; align-items: center; justify-content: center;
    width: 100%; height: 100%; font-size: calc(var(--fav-size) * 0.6);
    font-weight: 600; color: #fff; text-transform: uppercase; line-height: 1;
  }

  .title-wrap { display: flex; flex-direction: column; gap: 2px; min-width: 0; align-self: center; justify-content: center; }
  .title { font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .pin { font-size: 11px; color: #666; margin-right: 6px; }
  body.full-title .title { white-space: normal; overflow: visible; text-overflow: clip; word-break: break-word; }
  .tile.no-meta .title-wrap { align-self: center; justify-content: center; }

  .btn-icon {
    appearance: none; border: none; background: transparent; color: #666; font-size: 14px; cursor: pointer; padding: 0 2px; border-radius: 4px;
  }
  .btn-icon:hover { 
  /* background: #eee; */
  color: #000; }
  .btn-icon.btn-select { min-width: 1.5em; }

  html.as-autoscroll, html.as-autoscroll * { cursor: all-scroll !important; }

  .drag-ghost {
    position: fixed;
    z-index: 9999;
    pointer-events: none;
    /* rozmiar nadpisywany z JS (kwadrat) */
    width: 40px;
    height: 40px;

    display: flex; align-items: center; justify-content: center;
    padding: var(--tile-pad);
    border: 1px solid #d0d7de;
    border-radius: 8px;

    /* ‚Äûjak kafel‚Äù ‚Äì jasny */
    background: linear-gradient(180deg, #ffffff 0%, #f6f8fa 100%);
    color: #24292f;

    opacity: .9;
    box-shadow: 0 1px 2px rgba(31,35,40,.09);
    transform: translate(-9999px, -9999px);
  }
  .drag-ghost .cnt {
    display: block;
    font-weight: 800;
    line-height: 1;
  }

  @media (prefers-color-scheme: dark) {
    .drag-ghost {
      background: linear-gradient(180deg, #161b22 0%, #0d1117 100%);
      border-color: #30363d;
      color: #c9d1d9;
      box-shadow: none;
    }
  }

.marquee {
  position: fixed;
  z-index: 7; /* nad kaflami (i group-frames=5), ale poni≈ºej header/footer */
  pointer-events: none;
  background: transparent;
  border: 3px solid var(--marquee-stroke);
  border-radius: 4px;
  transform: translate(-9999px,-9999px);
}

  .active { border-color: var(--marquee-stroke); box-shadow: 0 0 0 2px var(--selected-glow); }
  .muted { opacity: .6; }

  footer { padding: 2px 12px; color: #57606a; font-size: 11px; border-top: 1px solid #d0d7de; }

  @media (max-width: 700px) {
    :root { --controls-minw: 160px; }
    main { padding: 0px; }
  }

  .filter-input { width: 150px; max-width: 100%; flex: 0 0 150px; }
  .control label.rev.rev-filter { flex-wrap: nowrap; white-space: nowrap; align-items: center; gap: 6px; margin-right: 10px; }
  .control label.rev.rev-filter .filter-input { flex: 0 0 150px; }

  .meta { font-size: 11px; color: #57606a; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .tile.no-meta .meta { display: none; }

  /* Pasek z przyciskiem Ustawienia (summary) */
  .settings-drawer { display: grid; grid-template-rows: auto 1fr; grid-template-areas: "toggle" "body"; margin: 0 0 -4px 0; }
  .settings-drawer[open] { grid-template-areas: "body" "toggle"; }
  .settings-toggle {
    grid-area: toggle;
    display: inline-flex; align-items: center; justify-content: center;
    padding: 0px 10px; margin: 0 auto; border: 1px solid #d0d7de; border-radius: 999px;
    background: #fff; color: #24292f; font-size: 12px; line-height: 1.2; cursor: pointer; user-select: none; margin-top: 2px;
    min-height: 16px;
    gap: 8px;
  }
  .settings-toggle:hover { background: #f3f4f6; }
  .settings-toggle:focus { outline: 2px solid #0969da33; outline-offset: 2px; }

  .settings-toggle::-webkit-details-marker { display: none; }
  .settings-toggle::before, .settings-toggle::after { color: #57606a; font-size: 11px; }
  .settings-toggle::before { content: "‚ñº"; margin-right: 12px; }
  .settings-toggle::after  { content: "‚ñº"; margin-left: 12px; }
  .settings-drawer[open] .settings-toggle::before,
  .settings-drawer[open] .settings-toggle::after { content: "‚ñ≤"; }

  @media (prefers-color-scheme: dark) {
    header { background: #161b22; border-bottom-color: #30363d; }
    .muted-text { color: #8b949e; }
    .settings-toggle { background: #0d1117; color: #c9d1d9; border-color: #30363d; }
    .settings-toggle:hover { background: #1f232a; }
    .settings-toggle:focus { outline: 2px solid #0969da33; outline-offset: 2px; }

    .btn { background: #0d1117; color: #c9d1d9; border-color: #30363d; }
    .btn:hover { background: #21262d; }
    .section { background: #161b22; border-color: #30363d; }
    .section > legend { color: #8b949e; }
    .grid.columns .tile, .tile { background-color: #161b22; border-color: #2a2f36; box-shadow: none; }
    
    /* W dark mode zaznaczony musi mieƒá ciemne t≈Ço pod spodem */
    .tile.selected { background-color: #161b22; }
    
    /* Hover w dark mode (zmieniamy kolor mgie≈Çki na bia≈Çy, bo currentColor jest jasny, ale w .selected t≈Ço jest ciemne) */
    .tile:hover::after { opacity: 0.1; } 
    
    /* W trybie ciemnym zaznaczony kafel musi mieƒá ciemne t≈Ço pod spodem */
    .tile.selected { background-color: #161b22; }
	
    /* Hover w dark mode: */
    .tile:hover { 
        /* Nak≈Çadka rozja≈õniajƒÖca */
        background-image: linear-gradient(rgba(255,255,255,0.08), rgba(255,255,255,0.08));
        
        /* WA≈ªNE: Przywr√≥ƒá solidne t≈Ço, ≈ºeby przykryƒá overlay grupy, gdy kafel jest na wierzchu */
        background-color: #161b22; 
        
        z-index: 2; /* Upewnij siƒô, ≈ºe jest nad overlayem */
    }
    /* Dla zaznaczonego w dark mode color-mix zadzia≈Ça automatycznie, 
       ale mo≈ºna te≈º tu nic nie dawaƒá, bo zmienna za≈Çatwi sprawƒô */
    .active { border-color: #388bfd; box-shadow: 0 0 0 2px rgba(56,139,253,.15); }
    .meta { color: #8b949e; }
  }

  .grid .tile > .fav-wrap > img.fav {
    width: 100% !important;
    height: 100% !important;
    max-width: 100% !important;
    max-height: 100% !important;
    object-fit: contain !important;
  }

  /* Menu rozwijane (baza) */
  .menu {
    position: absolute;
    left: 0;
    top: calc(100% + 6px);
    background: #fff;
    border: 1px solid #d0d7de;
    border-radius: 6px;
    min-width: 200px; /* Domy≈õlnie wƒô≈ºsze */
    max-width: 320px;
    max-height: min(360px, 70vh);
    overflow: auto;
    box-shadow: 0 8px 24px rgba(140,149,159,0.2);
    z-index: 10000;
    padding: 6px;
  }

  /* Specyficzne rozmiary */
  #restoreMenu {
    min-width: 300px;
    max-width: 480px;
  }
  #menuGroupMove, #menuGroupList {
    min-width: 160px;
    max-width: 300px;
  }
  .menu .mi {
    display: grid;
    grid-template-columns: var(--fav-size) 1fr auto;
    gap: 8px;
    align-items: center;
    padding: 6px;
    border-radius: 6px;
    cursor: pointer;
  }
  .menu .mi:hover { background: #f3f4f6; }
  .menu .mi .t {
    font-size: 13px; line-height: 1.2;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .menu .mi .m {
    font-size: 11px; color: #57606a;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .menu .empty {
    font-size: 12px; color: #57606a; padding: 6px;
  }

  @media (prefers-color-scheme: dark) {
    .menu {
      background: #161b22;
      border-color: #30363d;
      box-shadow: none;
    }
    .menu .mi:hover { background: #1f232a; }
    .menu .m, .menu .empty { color: #8b949e; }
  }

  /* Smart tooltip (zamiast title="") */
  .smart-tip {
    position: fixed;
    z-index: 10060;
    max-width: 320px;
    padding: 8px 10px;
    font-size: 12px;
    line-height: 1.3;
    color: #24292f;
    background: #fff;
    border: 1px solid #000000;
    border-radius: 8px;
    box-shadow: none;
    pointer-events: none;
    transform: translate(-9999px,-9999px);
    white-space: normal;
  }
  @media (prefers-color-scheme: dark) {
    .smart-tip {
      color: #c9d1d9;
      background: #161b22;
      border-color: #30363d;
      box-shadow: none;
    }
  }

/* Nak≈Çadki grup ‚Äî underlay (wype≈Çnienie pod kaflami) + overlay (obrys/chip nad kaflami) */
.group-underlay {
  position: absolute; inset: 0;
  pointer-events: none;
  z-index: -1; /* pod kaflami (nie zas≈Çania) */
}
.group-underfill {
  position: absolute; inset: 0;
  border-radius: 8px;
  background: transparent; /* fallback bez wype≈Çnienia */
  pointer-events: none;
}

/* Wype≈Çnienie z color-mix (Chromium/Brave) */
@supports (background: color-mix(in srgb, red 50%, transparent)) {
  .group-underfill { background: color-mix(in srgb, currentColor 18%, transparent); }
}
@media (prefers-color-scheme: dark) {
  @supports (background: color-mix(in srgb, red 50%, transparent)) {
    .group-underfill { background: color-mix(in srgb, currentColor 25%, transparent); }
  }
}

/* Fallback dla starszych: brak color-mix ‚Üí opacity na currentColor */
@supports not (background: color-mix(in srgb, red 50%, transparent)) {
  .group-underfill::before {
    content: ""; position: absolute; inset: 0;
    background: currentColor; opacity: .18; border-radius: inherit; pointer-events: none;
  }
  @media (prefers-color-scheme: dark) {
    .group-underfill::before { opacity: .25; }
  }
}

/* Overlay (obrys + chip) jak dotƒÖd */
.group-frames {
  position: absolute; inset: 0;
  pointer-events: none;
  z-index: 5;
}
.group-frame {
  position: absolute;
  z-index: 1; /* nad overlayfill */
  border: 2px solid currentColor;
  border-radius: 8px;
  background: transparent;
  box-sizing: border-box;
}

/* Neutralizacja wype≈Çnienia overlaya (zostaje tylko border/chip) */
.group-frame { background: transparent !important; }
.group-frame::before { content: none !important; }





/*
  .group-chip.selected {
  background: var(--selected-bg);
  box-shadow:
    0 0 0 2px var(--selected-glow) inset,
    0 0 0 3px var(--selected-glow);
} 
*/





.group-chip.selected {
  background: #fff; /* pe≈Çne t≈Ço jak w stanie normalnym */
  box-shadow: none;
}
@media (prefers-color-scheme: dark) {
  .group-chip.selected { background: #161b22; }
}


.group-frame.selected {
  box-shadow: 0 0 0 3px var(--selected-glow);
}

.group-overlayfill {
  position: absolute;
  z-index: 1; /* Podnosimy overlay ponad zwyk≈Çe kafle */
  border-radius: 8px;
  background: var(--selected-bg); /* Taki sam kolor jak kafel (12%) */
  box-shadow: 0 0 0 3px var(--selected-glow) inset;
  pointer-events: none;
}

.group-chip {
  position: absolute;
  z-index: 2; /* ponad ramkƒÖ i overlayfill */
  top: -10px; left: 10px;
  display: inline-flex; align-items: center; gap: 8px;
  font-size: 13px; line-height: 1; /* jak tytu≈Ç kafla */
  padding: 2px 6px;
  border-radius: 3px;
  border: 1px solid currentColor;
  background: #fff;
  color: inherit;
  white-space: nowrap;
  pointer-events: auto;
  box-sizing: border-box; /* szeroko≈õƒá liczy padding/border */
  cursor: pointer; /* jak kafel */
}
  .group-chip:hover { background: #f3f4f6; }            /* jak .tile:hover */
  @media (prefers-color-scheme: dark) {
    .group-chip { background: #161b22; }
    .group-chip:hover { background: #1f232a; }
  }
  .group-chip .ico {
    font-size: clamp(16px, calc(var(--fav-size) * 0.30), 32px); /* min 16px, 30%, max 32px */
    line-height: 1;
    margin-right: -5px;
    vertical-align: -1px;
  }
  .group-chip .name {
	font-size: 13px;
	line-height: 1;
	flex: 1 1 auto;
	min-width: 0;
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis; /* ‚Ä¶ jak w tytule kafla */
	}
	
	/* Tryb Ca≈Ça nazwa ‚Äì taki sam jak dla kafli */
	body.full-title .group-chip .name {
  white-space: normal;
  overflow: visible;
  text-overflow: clip;
  word-break: break-word;
}

  .group-chip .actions {
    display: inline-flex; align-items: center; gap: 3px;
    margin-left: auto;                                /* ikony po prawej, jak w kaflu */
  }
  .group-chip .actions .btn-icon {
    appearance: none; border: none; background: transparent; color: #666;
    font-size: 14px; line-height: 1; padding: 0 2px; border-radius: 4px; cursor: pointer;
  }
  .group-chip .actions .btn-icon {margin: 0 -2px !important;}
  
  .group-chip .actions .btn-icon:hover { background: #eee; color: #000; }
  .group-chip .actions .btn-arrow { font-size: 16px; } /* ‚ñæ/‚ñ∏ wiƒôksze */
  @media (prefers-color-scheme: dark) {
    .group-chip { background: #161b22; }
    .group-chip .actions .btn-icon:hover { background: #1f232a; color: #c9d1d9; }
  }

  /* DnD: pionowy pasek wstawiania (miƒôdzy kaflami) */
  .dnd-overlay { position: absolute; inset: 0; pointer-events: none; z-index: 8; }
  .insert-caret {
    position: absolute;
    width: 4px;
    background: var(--marquee-stroke);
    border-radius: 2px;
    box-shadow: 0 0 0 1px var(--selected-glow);
    pointer-events: none;
    transform: translate(-9999px,-9999px);
  }
  

/* Media activity blink */
@keyframes media-blink {
  0%   { outline-color: var(--marquee-stroke); }
  50%  { outline-color: transparent; }
  100% { outline-color: var(--marquee-stroke); }
}
.tile.media-active {
  outline: 3px solid var(--marquee-stroke);
  outline-offset: -3px;
  animation: media-blink 2s ease-in-out infinite;
}

/* Badge dla zwiniƒôtej grupy (liczba ukrytych kafli) */
.grp-collapsed-count {
  display: inline-block;
  font-size: 11px;
  padding: 1px 6px;
  margin-right: 6px;
  color: #57606a;
  border: 1px solid #d0d7de;
  border-radius: 999px;
  vertical-align: middle;
}
@media (prefers-color-scheme: dark) {
  .grp-collapsed-count {
    color: #8b949e;
    border-color: #30363d;
  }
}
/* Folderowa favka bez t≈Ça */
.tile.collapsed-group .fav.is-letter { background: transparent !important; }

header, footer {
  position: relative;
  z-index: 20; /* ponad .marquee (7) i ponad gridem */
}
</style>
</head>
<body>
<header>
  <details class="settings-drawer" id="settings">
    <summary class="settings-toggle" title="Poka≈º/ukryj panel ustawie≈Ñ siatki i MRU">Ustawienia</summary>
    <div class="settings-body">
      <div class="sections">
        <!-- Sekcja 1: Nawigacja / MRU -->
        <fieldset class="section" title="Ustawienia mechanizmu MRU i przypinania siatki">
          <legend>Nawigacja</legend>
          <div class="controls compact">
            <div class="control">
              <label class="rev" title="Ile ostatnich klikniƒôƒá zapamiƒôtaƒá (0-50). 0 - wy≈ÇƒÖcza funkcjonalno≈õƒá.">
                <span class="lab">Historia klikniƒôƒá</span><input id="depth" type="number" min="0" max="50" step="1" />
              </label>
            </div>
            <div class="control">
              <label title="Gdy w≈ÇƒÖczone: przypiƒôte karty nie trafiajƒÖ do historii MRU. Gdy wy≈ÇƒÖczone i siatka jest przypiƒôta ‚Äì po zamkniƒôciu karty wr√≥cisz do siatki.">
                <input id="ignorePinnedExt" type="checkbox" />Ignoruj przypiƒôte w historii
              </label>
            </div>
            <div class="control">
              <label title="Po klikniƒôciu ikony rozszerzenia siatka otwiera siƒô jako przypiƒôta karta.">
                <input id="autoPin" type="checkbox" />Otwieraj siatkƒô kart przypiƒôtƒÖ
              </label>
            </div>

            <!-- Kontener na przyciski (zajmuje ca≈ÇƒÖ szeroko≈õƒá) -->
            <div style="grid-column: 1 / -1; display:flex; flex-direction:column; align-items:flex-end; gap:6px; margin-top:4px;">
                
                <!-- RzƒÖd 1 -->
                <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
                    <button id="refresh" class="btn" title="Od≈õwie≈ºa siatkƒô i czy≈õci zaznaczenia (‚òê/‚òë)">Od≈õwie≈º ‚Üª</button>

                    <div class="restore-wrap" style="display:inline-block; position:relative;">
                        <button id="restoreMenuBtn" class="btn" title="Poka≈º historiƒô zamkniƒôtych kart" aria-haspopup="true" aria-expanded="false">Przywr√≥ƒá ‚Ü∂</button>
                        <div id="restoreMenu" class="menu" role="menu" style="display:none;"></div>
                    </div>
                  
                    <button id="deleteSelectedBtn" class="btn" title="Usu≈Ñ zaznaczone karty i grupy (Delete)" disabled>Usu≈Ñ üóë</button>
                </div>

                <!-- RzƒÖd 2 -->
                <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
                    <button id="btnGroupNew" class="btn" disabled title="Utw√≥rz nowƒÖ grupƒô z zaznaczonych">Grupuj</button>
                    
                    <div class="grp-move-wrap" style="display:inline-block; position:relative;">
                        <button id="btnGroupMove" class="btn" aria-haspopup="true" disabled title="Przenie≈õ zaznaczone do istniejƒÖcej grupy">Przenie≈õ ‚ñº</button>
                        <div id="menuGroupMove" class="menu" role="menu" style="display:none;"></div>
                    </div>

                    <button id="btnGroupProps" class="btn" disabled title="Edytuj nazwƒô i kolor zaznaczonej grupy">W≈Ça≈õciwo≈õci</button>
                    
                    <div class="grp-list-wrap" style="display:inline-block; position:relative;">
                        <button id="btnGroupList" class="btn" aria-haspopup="true" title="Lista wszystkich grup (ukryte/widoczne)">Lista ‚ñº</button>
                        <div id="menuGroupList" class="menu" role="menu" style="display:none;"></div>
                    </div>
<div id="groupEditDialog" style="display:none; border:1px solid #d0d7de; border-radius:8px; padding:16px; position:absolute; width:260px; background:#fff; color:#24292f; z-index:10100; box-shadow:0 8px 24px rgba(0,0,0,0.2);">
    <div style="font-weight:600; margin-bottom:12px;">Edycja Grupy</div>
    <input id="gedTitle" type="text" placeholder="Nazwa grupy" style="width:100%; padding:6px; margin-bottom:12px; box-sizing:border-box; border:1px solid #d0d7de; border-radius:4px;">
    <div id="gedColors" style="display:grid; grid-template-columns:repeat(8,1fr); gap:6px; margin-bottom:16px;"></div>
    
    <!-- Akcje (tylko przy edycji istniejƒÖcej grupy) -->
    <div id="gedActions" style="display:none; flex-direction:column; gap:4px; margin-bottom:16px; border-top:1px solid #d0d7de; padding-top:12px;">
        <button id="actToggle" class="btn" style="text-align:left; width:100%;">‚ñæ‚ñ∏ Zwi≈Ñ / Rozwi≈Ñ</button>
        <button id="actHide" class="btn" style="text-align:left; width:100%;">üëÅ Ukryj (Zamknij)</button>
        <button id="actUngroup" class="btn" style="text-align:left; width:100%;">‚á± Rozgrupuj (zostaw karty)</button>
        <button id="actDelete" class="btn" style="text-align:left; width:100%; color:#d1242f;">üóë Usu≈Ñ (z kartami)</button>
    </div>

    <div style="display:flex; justify-content:flex-end; gap:8px;">
        <button id="gedCancel" class="btn">Anuluj</button>
        <button id="gedSave" class="btn" style="background:#0969da; color:#fff; border-color:#0969da;">Zapisz</button>
    </div>
</div>
                </div>
            </div>
          </div>
        </fieldset>

        <!-- Sekcja 2: Siatka -->
        <fieldset class="section" title="Uk≈Çad siatki kafelk√≥w i rozmiary">
          <legend>Siatka</legend>
          <div class="controls compact">
            <div class="control">
              <label class="rev" title="Spos√≥b uk≈Çadu: wiersze (poziomo), kolumny (pionowo) lub automatycznie dopasuj do szeroko≈õci okna.">
                <span class="lab">Uk≈Çad</span>
                <select id="orientation">
                  <option value="horizontal">wiersze</option>
                  <option value="vertical">kolumny</option>
                  <option value="auto">dopasuj</option>
                </select>
              </label>
            </div>
            <div class="control">
              <label id="labelCount" class="rev" title="W poziomie: liczba wierszy. W pionie: liczba kolumn. W auto: pole niewykorzystywane.">
                <span class="lab">Wiersze</span><input id="count" type="number" min="1" max="300" step="1" />
              </label>
            </div>
            <div class="control">
              <label class="rev" title="Minimalna szeroko≈õƒá kafla (px). W auto to minimalna szeroko≈õƒá toru w siatce.">
                <span class="lab">Szeroko≈õƒá</span><input id="tileW" type="number" min="16" max="2000" step="1" />
              </label>
            </div>
            <div class="control">
              <label class="rev" title="Wysoko≈õƒá wiersza kafla (px). Razem z &quot;Dodatkowe info&quot; wp≈Çywa na wysoko≈õƒá kafla.">
                <span class="lab">Wysoko≈õƒá</span><input id="tileH" type="number" min="16" max="200" step="1" />
              </label>
            </div>
            <div class="control">
              <label class="rev" title="Odstƒôp wewnƒÖtrz kafla (px).">
                <span class="lab">Padding</span><input id="tilePad" type="number" min="0" max="25" step="1" />
              </label>
            </div>
            <div class="control">
              <label class="rev" title="Rozmiar favicon (px). Tylko lokalne ≈∫r√≥d≈Ça (chrome://favicon, /favicon.ico).">
                <span class="lab">Ikonki</span><input id="iconSize" type="number" min="16" max="128" step="1" />
              </label>
            </div>
          </div>
        </fieldset>

        <!-- Sekcja 3: Widok -->
        <fieldset class="section" title="Widoczno≈õƒá i kolejno≈õƒá kart w siatce">
          <legend>Widok</legend>
          <div class="controls compact">
            <div class="control">
              <label class="rev" title="Kolejno≈õƒá kafli: po indeksie (pasek kart) lub po czasie aktywacji (ostatnio u≈ºywane).">
                <span class="lab">Sortowanie</span>
                <select id="sort">
                  <option value="index-asc">indeks +</option>
                  <option value="index-desc">indeks -</option>
                  <option value="time-desc">czas +</option>
                  <option value="time-asc">czas -</option>
                </select>
              </label>
            </div>
            <div class="control">
              <label class="rev rev-filter" title="Filtruje po tytule i URL. Nie resetuje zaznacze≈Ñ (‚òê/‚òë).">
                <span class="lab">Filtr</span>
                <input id="filter" type="search" class="filter-input" placeholder="tytu≈Ç lub URL..." />
              </label>
            </div>
            <div class="control">
              <label title="Ukrywa przypiƒôte karty w siatce (nie wp≈Çywa na MRU).">
                <input id="hidePinned" type="checkbox" />Ukryj przypiƒôte zak≈Çadki
              </label>
            </div>
            <div class="control">
              <label title="Pokazuje drugi wiersz z hostem i czasem u≈ºycia.">
                <input id="showMeta" type="checkbox" />Dodatkowe info
              </label>
            </div>
            <div class="control">
				<label title="Poka≈º przyciski w kaflach: ‚òê/‚òë (zaznacz), ‚Üª (od≈õwie≈º), üóë (usu≈Ñ).">
				  <input id="showClose" type="checkbox" />Poka≈º ‚òê ‚Üª üóë
				</label>
            </div>
            <div class="control">
              <label title="Wy≈ÇƒÖcz elipsƒô; pozw√≥l na zawijanie ca≈Çego tytu≈Çu na wiele linii.">
                <input id="fullTitle" type="checkbox" />Ca≈Ça nazwa
              </label>
            </div>
            
            <!-- Wyb√≥r koloru -->
            <div class="control">
                <div class="accent-wrap" style="display:inline-block; position:relative;">
                    <button id="btnAccentColor" class="btn" aria-haspopup="true" title="Zmie≈Ñ kolor g≈Ç√≥wny zaznaczenia">
                        <span id="accentDot" style="display:inline-block; width:10px; height:10px; border-radius:50%; background:#0969da; margin-right:6px;"></span>
                        Kolor bazowy
                    </button>
                    <div id="menuAccentColor" class="menu" role="menu" style="display:none; min-width:160px; left:0; right:auto;"></div>
                </div>
            </div>
          </div>
        </fieldset>
      </div>
    </div>
  </details>

  <!-- ‚Äû?‚Äù po prawej krawƒôdzi paska -->
  <button id="helpBtnTop" class="help-btn-top" type="button" aria-haspopup="dialog" aria-expanded="false" title="Informacje">?</button>
  <div id="helpTipTop" class="help-panel-top" style="display:none;" role="dialog" aria-label="Informacje">
    <div class="hp-title">LastTAB-return ‚Äî informacje</div>
    <div class="hp-body">
      <p style="margin-bottom:8px;"><strong>Mysz i zaznaczanie</strong></p>
      <ul>
        <li><strong>LPM</strong>: aktywuje kartƒô. Na przycisku ‚òê zaznacza.</li>
        <li><strong>≈öPM</strong>: klikniƒôcie zamyka kartƒô. Przytrzymanie w≈ÇƒÖcza autoscroll.</li>
        <li><strong>PPM</strong>: szybkie zaznaczenie (solo). Z ruchem = Przenoszenie (DnD). Na tle = Zaznaczanie obszarem.</li>
        <li><strong>Ctrl+Klik PPM</strong>: dodaje do zaznaczenia (toggle).</li>
      </ul>

      <p style="margin:8px 0;"><strong>Przenoszenie (D&D)</strong></p>
      <ul>
        <li>Chwyƒá zaznaczone karty lub grupƒô, aby przenie≈õƒá.</li>
        <li>Wska≈∫nik w <strong>kolorze grupy</strong> = wstawienie do ≈õrodka (do≈ÇƒÖcz).</li>
        <li>Wska≈∫nik <strong>neutralny</strong> = wstawienie obok (omi≈Ñ grupƒô).</li>
      </ul>

      <p style="margin:8px 0;"><strong>Grupy i Akcje</strong></p>
      <ul>
        <li><strong>Grupuj / W≈Ça≈õciwo≈õci</strong>: tworzenie i edycja (nazwa, kolor).</li>
        <li><strong>Przenie≈õ / Lista</strong>: zarzƒÖdzanie kartami w grupach.</li>
        <li><strong>Ukryj (üëÅ)</strong>: zwija grupƒô i chowa jƒÖ z siatki (dostƒôpna w menu "Lista").</li>
        <li><strong>Klawisz Delete</strong>: usuwa zaznaczone karty i grupy.</li>
      </ul>
      
      <p style="margin-top:8px; font-size:12px; color:#57606a;">ESC: anuluje akcjƒô lub czy≈õci zaznaczenie.</p>
	  <p style="margin-top:8px; font-size:12px; color:#57606a;">Shift+PPM: natywne menu.</p>
    </div>
  </div>
</header>

<main>
  <div id="grid" class="grid"></div>
</main>
<footer id="info"></footer>

<script src="switcher.js"></script>
</body>
</html>